# AA Bytecode Insertion Tool

Prototype of a python3 tool for modifying EVM bytecode (as outputted by `solc`, including the constructor code) to include the account abstraction (AA) bytecode prefix.
Note: This tool is only meant to be used for AA prototyping. Going forward, it is supposed to be replaced by a proper solidity integration.

## Usage
```
usage: process.py [-h] [-e ENTRYPOINT] bytecode

positional arguments:
  bytecode              Contract bytecode

optional arguments:
  -h, --help            show this help message and exit
  -e ENTRYPOINT, --entrypoint ENTRYPOINT
                        Entry point address. Defaults to 0xffffffffffffffffffffffffffffffffffffffff
```

Using the `AA` contract from `example.sol`:
```
$ python process.py `solc --bin example.sol | tail -1`
0x6080604052600160005534801561001557600080fd5b50610183806100256000396000f3fe3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b6080604052348015600f906100d75750600080fd5b50600436106032906100d7575060003560e01c8063e5aa3d58146037906100d757508063e5c19b2d146053906100d757505b600080fd5b603d607e6100d7565b6040518082815260200191505060405180910390f35b607c600480360360208110156067906100d75750600080fd5b810190808035906020019092919050505060846100d7565b005b600054816100d7565b80600081905550506100d756fe5b9050565b6100338161000f146100d3575061006581610032146100d3575061006a81610037146100d357506100738161003d146100d3575061008981610053146100d357506100a281610067146100d357506100ba8161007c146100d357506100bc8161007e146100d357506100c581610084146100d35750fea26469706673582212201439e38108e1ca88e305c64349ff7a261f21cc4385eec971ce78d492bf80848c64736f6c63430006060033
```

For testing purposes the AA entry point can be changed to a specified Ethereum address via the entrypoint argument, e.g.:
```
$ python process.py `solc --bin example.sol | tail -1` -e 0x04D867459000b8371B7D88c2De900F6a4C074a00
```

For analysis of the bytecode [this](https://ethervm.io/decompile) decompilation tool can be useful.
Bytecodes for the `example.sol`:
```
Original bytecode with constructor:
6080604052600160005534801561001557600080fd5b5060c4806100246000396000f3fe6080604052348015600f57600080fd5b506004361060325760003560e01c8063e5aa3d58146037578063e5c19b2d146053575b600080fd5b603d607e565b6040518082815260200191505060405180910390f35b607c60048036036020811015606757600080fd5b81019080803590602001909291905050506084565b005b60005481565b806000819055505056fea26469706673582212201439e38108e1ca88e305c64349ff7a261f21cc4385eec971ce78d492bf80848c64736f6c63430006060033

Original bytecode without constructor:
6080604052348015600f57600080fd5b506004361060325760003560e01c8063e5aa3d58146037578063e5c19b2d146053575b600080fd5b603d607e565b6040518082815260200191505060405180910390f35b607c60048036036020811015606757600080fd5b81019080803590602001909291905050506084565b005b60005481565b806000819055505056fea26469706673582212201439e38108e1ca88e305c64349ff7a261f21cc4385eec971ce78d492bf80848c64736f6c63430006060033

Modified bytecode with constructor:
6080604052600160005534801561001557600080fd5b50610183806100256000396000f3fe3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b6080604052348015600f906100d75750600080fd5b50600436106032906100d7575060003560e01c8063e5aa3d58146037906100d757508063e5c19b2d146053906100d757505b600080fd5b603d607e6100d7565b6040518082815260200191505060405180910390f35b607c600480360360208110156067906100d75750600080fd5b810190808035906020019092919050505060846100d7565b005b600054816100d7565b80600081905550506100d756fe5b9050565b6100338161000f146100d3575061006581610032146100d3575061006a81610037146100d357506100738161003d146100d3575061008981610053146100d357506100a281610067146100d357506100ba8161007c146100d357506100bc8161007e146100d357506100c581610084146100d35750fea26469706673582212201439e38108e1ca88e305c64349ff7a261f21cc4385eec971ce78d492bf80848c64736f6c63430006060033

Modified bytecode without constructor:
3373ffffffffffffffffffffffffffffffffffffffff14601e57600080fd5b6080604052348015600f906100d75750600080fd5b50600436106032906100d7575060003560e01c8063e5aa3d58146037906100d757508063e5c19b2d146053906100d757505b600080fd5b603d607e6100d7565b6040518082815260200191505060405180910390f35b607c600480360360208110156067906100d75750600080fd5b810190808035906020019092919050505060846100d7565b005b600054816100d7565b80600081905550506100d756fe5b9050565b6100338161000f146100d3575061006581610032146100d3575061006a81610037146100d357506100738161003d146100d3575061008981610053146100d357506100a281610067146100d357506100ba8161007c146100d357506100bc8161007e146100d357506100c581610084146100d35750fea26469706673582212201439e38108e1ca88e305c64349ff7a261f21cc4385eec971ce78d492bf80848c64736f6c63430006060033
```